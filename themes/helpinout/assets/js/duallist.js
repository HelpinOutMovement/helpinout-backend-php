!function(t){"use strict";var e=function(e,a){this.options=a,this.$element=t(e),this.$element.attr("selectedIndex",-1),this.$container=t("<div/>",{"class":"wmdl-container"}),this.$selectable_list=t("<ul/>",{"class":"wmdl-list wmdl-selectable-list"}),this.$selected_list=t("<ul/>",{"class":"wmdl-list wmdl-selected-list"}),this.$header=t("<div/>",{"class":"wmdl-headers-container"})};e.prototype={constructor:e,init:function(t){var e=this.$element;if(0==e.next(".wmdl-container").length){this.generateID();var a=this.generateDL();return e.after(a),e.hide(),a}},generateID:function(e){var a=this.$element,l=this.$element.attr("id"),d=1,s=1;a.find("optgroup").each(function(){t(this).attr("data-group-id",l+"-g-"+d),d++}),a.find("option").each(function(){t(this).attr("data-option-id",l+"-o-"+s),s++})},generateDL:function(t){var e=this.$element,a=this.$container,l=this.selectableList(),d=this.selectedList();e.prop("disabled")&&a.addClass("wmdl-disabled");var s=this.options.selectableList_header,i=this.options.selectedList_header;if(null!=s||null!=i){var n=this.listHeaders();a.addClass("has-header").append(n)}return a.append(l).append(d),a.addClass(this.options["class"]),a},listHeaders:function(){var e=this.options.selectableList_header,a=this.options.selectedList_header,l=this.$header,d=t("<div/>").addClass("wmdl-header wmdl-selectable-list-header").text(e),s=t("<div/>").addClass("wmdl-header wmdl-selected-list-header").text(a);return l.append(d).append(s),l},selectableList:function(e){t.extend(this.options,e);var a=this,l=this.$selectable_list,d=this.$element,s=this.options.selectableList_class,i=this.options.items_class;null!=s&&l.addClass(s);var n=d.children("optgroup");return n.length>0&&n.each(function(e,a){var d=t(a),s=d.attr("data-group-id"),i=d.attr("label"),n=d.attr("disabled"),r="";n&&(r="wmdl-group-disabled"),(""==i||void 0==i)&&(i="<small>Group</small>");var o=t("<li>").addClass("wmdl-has-group").addClass(r).html('<span class="wmdl-group-label">'+i+"</span>"),p=t("<ul>").addClass("wmdl-group").attr("data-wmdl-group",s);o.append(p),l.append(o)}),d.find("option").each(function(e,d){var s=t(d),n=s.attr("data-option-id"),r=s.attr("value"),o=s.text(),p=s.attr("disabled"),c=s.parent("optgroup"),h="";p&&(h="wmdl-option-disabled");var u=s.attr("data-wmdl-html");if(u&&(o=u,h+=" wmdl-html-option"),null!=i&&(h+=" "+i),s.is(":selected"))var m=t("<li>").css("display","none").addClass("wmdl-option").addClass(h).attr("data-wmdl-value",r).attr("data-wmdl-option",n).html(o);else var m=t("<li>").attr("data-wmdl-value",r).addClass("wmdl-option").addClass(h).attr("data-wmdl-option",n).html(o);if(c.length>0){var f=c.attr("data-group-id");l.find('[data-wmdl-group="'+f+'"]').append(m)}else l.append(m);m.hasClass("wmdl-option-disabled")||a.addItem(m)}),setTimeout(function(){l.find(".wmdl-group").each(function(){var e=t(this);e.children(":visible").length<1&&e.parent().hide()})},100),l},selectedList:function(e){t.extend(this.options,e);var a=this,l=this.$element,d=this.$selected_list,s=this.options.selectedList_class,i=this.options.items_class;return null!=s&&d.addClass(s),l.find("option:selected").each(function(e,l){var s=t(l),n=s.attr("data-option-id"),r=s.attr("value"),o=s.text(),p=s.parent("optgroup");""==v&&(v="<small>Group</small>");var c=s.attr("disabled"),h="";c&&(h="wmdl-option-disabled");var u=s.attr("data-wmdl-html");u&&(o=u,h+=" wmdl-html-option"),null!=i&&(h+=" "+i);var m=t("<li>").attr("data-wmdl-value",r).addClass("wmdl-option").addClass(h).attr("data-wmdl-option",n).html(o);if(p.length>0){var f=p.attr("data-group-id"),w=d.find('[data-wmdl-group="'+f+'"]');if(w.length>0)w.append(m);else{var v=p.attr("label"),g=p.attr("disabled"),h="";g&&(h="wmdl-group-disabled");var b=t("<li>").addClass("wmdl-has-group").addClass(h).html('<span class="wmdl-group-label">'+v+"</span>"),$=t("<ul>").addClass("wmdl-group").attr("data-wmdl-group",f);b.append($),$.append(m),d.append(b)}}else d.append(m);m.hasClass("wmdl-option-disabled")||a.removeItem(m)}),d},addItem:function(e){var a=this,l=this.$element,d=(this.$selectable_list,this.$selected_list),s=e,i=s.attr("data-wmdl-option"),n=s.attr("data-wmdl-value"),r=this.options.afterAdded;s.on("click",function(){if(!t(this).parent().parent().hasClass("wmdl-group-disabled")&&!t(this).parents(".wmdl-container").hasClass("wmdl-disabled")){var e=(s.attr("data-wmdl-value"),s.clone()),o=s.parent(".wmdl-group"),p=d.find('[data-wmdl-option="'+i+'"]').length;if(0==p){if(o.length>0){var c=o.prev().text(),h=o.attr("data-wmdl-group"),u=d.find('[data-wmdl-group="'+h+'"]');if(!u.length>0){var m=t("<li>").addClass("wmdl-has-group").html('<span class="wmdl-group-label">'+c+"</span>"),f=t("<ul>").addClass("wmdl-group").attr("data-wmdl-group",h);f.append(e),m.append(f),d.append(m).hide().fadeIn("fast"),a.removeItem(e),l.find('[data-option-id="'+i+'"]').prop("selected",!0)}else u.append(e).hide().fadeIn("fast"),a.removeItem(e),l.find('[data-option-id="'+i+'"]').prop("selected",!0)}else l.find('[data-option-id="'+i+'"]').prop("selected",!0),d.append(e).hide().fadeIn("fast"),a.removeItem(e);s.addClass("wmdl-option-selected").fadeOut("fast",function(){s.parent(".wmdl-group").children(":visible").length<1&&s.parent(".wmdl-group").parent().fadeOut("fast")})}"function"==typeof r&&r.call(this,n)}})},removeItem:function(e){var a=this.$element,l=this.$selectable_list,d=this.$selected_list,s=e,i=s.attr("data-wmdl-option"),n=s.parent().attr("data-wmdl-group"),r=d.find('[data-wmdl-group="'+n+'"]'),o=s.attr("data-wmdl-value"),p=this.options.afterRemoved;s.on("click",function(){if(!t(this).parent().parent().hasClass("wmdl-group-disabled")&&!t(this).parents(".wmdl-container").hasClass("wmdl-disabled")){a.find('[data-option-id="'+i+'"]').prop("selected",!1),s.fadeOut("fast",function(){s.remove(),r.children("li").length<1&&r.parent().fadeOut("fast",function(){r.parent().remove()})});var e=l.find('[data-wmdl-option="'+i+'"]');e.removeClass("wmdl-option-selected").fadeIn("fast",function(){e.parent(".wmdl-group")&&e.parent(".wmdl-group").parent().fadeIn("fast")}),"function"==typeof p&&p.call(this,o)}})},getValue:function(){var e=this.$selected_list,a=(this.$selectable_list,[]);return e.find("li:not(.wmdl-option-disabled):not(.wmdl-has-group)").each(function(){var e=t(this);if(!e.parents(".wmdl-group").parent().hasClass("wmdl-group-disabled")){var l=e.attr("data-wmdl-value");a.push(l)}}),a},deselectAll:function(){var e=this.$element,a=this.$selected_list,l=this.$selectable_list;e.find("option").prop("selected",!1),t(a).html(""),t(l).find("[data-wmdl-option]").show().removeClass("wmdl-option-selected"),t(l).find("[data-wmdl-group]").show()},setValue:function(e){var a=this,l=this.$element;"string"==typeof e&&(e=[e]);var d=this.$selectable_list;this.$selected_list;t.when(a.deselectAll()).then(function(){for(var t=0;t<e.length;t++){l.find('option[value="'+e[t]+'"]:not(:disabled)').prop("selected",!0);var a=d.find('[data-wmdl-value="'+e[t]+'"]:not(.wmdl-option-disabled)');a.trigger("click")}})},setAll:function(e){var a=this.$selectable_list;this.$selected_list;t(a).find("[data-wmdl-option]").trigger("click")},addValue:function(t){"string"==typeof t&&(t=[t]);for(var e=this.$selectable_list,a=(this.$selected_list,0);a<t.length;a++){var l=e.find('[data-wmdl-value="'+t[a]+'"]');l.trigger("click")}},removeValue:function(t){"string"==typeof t&&(t=[t]);for(var e=this.$selected_list,a=0;a<t.length;a++){var l=e.find('[data-wmdl-value="'+t[a]+'"]');l.trigger("click")}},removeAll:function(t){var e=this.$selected_list,a=e.find("[data-wmdl-value]");a.trigger("click")},destroy:function(){var t=this.$element;t.next(".wmdl-container").length>0&&(t.next().remove(),this.$element.removeData("dualList"),t.fadeIn("fast"),t.find("[data-option-id]").removeAttr("data-option-id"),t.find("[data-group-id]").removeAttr("data-group-id"))}},t.fn.dualList=function(){var a,l=arguments[0],d=Array.prototype.slice.call(arguments,1);return this.each(function(){var s=t(this),i=s.data("dualList"),n=t.extend({},t.fn.dualList.defaults,s.data(),"object"==typeof l&&l);i||s.data("dualList",i=new e(this,n)),"string"==typeof l?a=i[l].apply(i,d):i.init()}),a},t.fn.dualList.defaults={"class":null,selectableList_header:null,selectedList_header:null,selectableList_class:null,selectedList_class:null,items_class:null},t.fn.dualList.Constructor=e}(window.jQuery);
